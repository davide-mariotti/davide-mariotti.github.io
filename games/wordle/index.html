<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Italiano</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../assets/icons/favicon/favicon.ico">

    <!-- Main Site CSS -->
    <link href="../../assets/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <!-- Bootstrap (Required for site layout variables if used in main.css) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Web Component Header -->
    <app-header></app-header>

    <div class="container py-5 mt-5">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <!-- Game Wrapper with Glass Effect -->
                <div class="glass-panel p-4 d-flex flex-column align-items-center" style="min-height: 80vh;">

                    <!-- Game Header (Internal) -->
                    <div
                        class="w-100 d-flex justify-content-between align-items-center mb-4 border-bottom border-secondary pb-3">
                        <!-- Left Side: Login / Profile -->
                        <div class="menu-left d-flex align-items-center">
                            <button id="login-btn" class="btn btn-sm btn-outline-light rounded-pill px-3"
                                style="font-size: 0.8rem;">
                                Login
                            </button>
                            <div id="user-profile" class="hidden d-flex align-items-center gap-2"
                                style="cursor: pointer;">
                                <img id="user-avatar" src="user.png" alt="User"
                                    class="rounded-circle border border-success" style="width: 32px; height: 32px;">
                            </div>
                        </div>

                        <h1 class="h3 m-0 text-gradient text-uppercase fw-bold">Wordle IT</h1>

                        <div class="menu-right d-flex gap-2">
                            <button id="achievements-btn"
                                class="btn btn-sm btn-outline-light rounded-circle p-2 d-flex align-items-center justify-content-center"
                                aria-label="Achievements" style="width: 40px; height: 40px;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                                    <path fill="currentColor" d="M12 2L9 9H2l6 5-2 8 6-4 6 4-2-8 6-5h-7z" />
                                </svg>
                            </button>
                            <button id="leaderboard-btn"
                                class="btn btn-sm btn-outline-light rounded-circle p-2 d-flex align-items-center justify-content-center"
                                aria-label="Classifica" style="width: 40px; height: 40px;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                                    <path fill="currentColor"
                                        d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z" />
                                </svg>
                            </button>
                            <button id="stats-btn"
                                class="btn btn-sm btn-outline-light rounded-circle p-2 d-flex align-items-center justify-content-center"
                                aria-label="Statistiche" style="width: 40px; height: 40px;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                                    <path fill="currentColor"
                                        d="M16,6L16,6h2v12h-2V6z M12,18h2V10h-2V18z M8,18h2v-4H8V18z M2,20v2h20v-2H2z">
                                    </path>
                                </svg>
                            </button>
                            <button id="help-btn"
                                class="btn btn-sm btn-outline-light rounded-circle p-2 d-flex align-items-center justify-content-center"
                                aria-label="Istruzioni" style="width: 40px; height: 40px;">
                                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                                    <path fill="currentColor"
                                        d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8 8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z">
                                    </path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Mode Selector -->
                    <div class="mode-selector mb-3 d-flex gap-2 justify-content-center flex-wrap">
                        <button class="mode-btn active" data-mode="practice">‚ú® Practice</button>
                        <button class="mode-btn" data-mode="timed">‚è±Ô∏è Timed</button>
                        <button class="mode-btn" data-mode="hard">üí™ Hard</button>
                    </div>

                    <!-- Timer (visible only in timed mode) -->
                    <div id="timer-container" class="timer-container hidden mb-3">
                        <div class="d-flex align-items-center gap-2">
                            <span class="timer-label small opacity-75">Tempo:</span>
                            <span id="timer-display" class="timer-display fw-bold">30</span>
                            <span class="small opacity-75">secondi</span>
                        </div>
                        <div class="progress-bar-container mt-2">
                            <div id="timer-progress" class="timer-progress-bar"></div>
                        </div>
                    </div>

                    <!-- Hard Mode Indicator -->
                    <div id="hard-mode-indicator" class="hard-mode-indicator hidden mb-2">
                        üí™ <span class="small">Modalit√† Hard Attiva - Usa tutte le lettere trovate!</span>
                    </div>

                    <div id="game-container" class="d-flex flex-column align-items-center w-100 flex-grow-1">
                        <div id="board-container" class="mb-4">
                            <div id="board"></div>
                        </div>

                        <div id="keyboard-container" class="w-100">
                            <div class="keyboard-row">
                                <button data-key="Q">Q</button>
                                <button data-key="W">W</button>
                                <button data-key="E">E</button>
                                <button data-key="R">R</button>
                                <button data-key="T">T</button>
                                <button data-key="Y">Y</button>
                                <button data-key="U">U</button>
                                <button data-key="I">I</button>
                                <button data-key="O">O</button>
                                <button data-key="P">P</button>
                            </div>
                            <div class="keyboard-row">
                                <button data-key="A">A</button>
                                <button data-key="S">S</button>
                                <button data-key="D">D</button>
                                <button data-key="F">F</button>
                                <button data-key="G">G</button>
                                <button data-key="H">H</button>
                                <button data-key="J">J</button>
                                <button data-key="K">K</button>
                                <button data-key="L">L</button>
                            </div>
                            <div class="keyboard-row">
                                <button data-key="ENTER" class="key-large">INVIO</button>
                                <button data-key="Z">Z</button>
                                <button data-key="X">X</button>
                                <button data-key="C">C</button>
                                <button data-key="V">V</button>
                                <button data-key="B">B</button>
                                <button data-key="N">N</button>
                                <button data-key="M">M</button>
                                <button data-key="BACKSPACE" class="key-large">‚Üê</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Web Component Footer -->
    <app-footer></app-footer>

    <!-- Modals -->

    <div id="modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-secondary shadow-lg">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="modal">&times;</span>
            <h2 class="h4 text-gradient mb-3">COME GIOCARE</h2>
            <p>Indovina la parola nascosta in 6 tentativi.</p>
            <p>Ogni tentativo deve essere una parola valida di 5 lettere. Premi Invio per inviare.</p>
            <p>Dopo ogni tentativo, il colore delle tessere cambier√† per mostrarti quanto sei andato vicino a
                indovinare la parola.</p>
            <hr class="border-secondary my-3">
            <div class="examples">
                <p><strong>Esempi</strong></p>
                <div class="example-row d-flex gap-2 mb-2">
                    <div class="tile" data-state="correct">G</div>
                    <div class="tile">A</div>
                    <div class="tile">T</div>
                    <div class="tile">T</div>
                    <div class="tile">O</div>
                </div>
                <p class="small">La lettera <strong>G</strong> √® nella parola e nel posto giusto.</p>
                <div class="example-row d-flex gap-2 mb-2">
                    <div class="tile">P</div>
                    <div class="tile" data-state="present">I</div>
                    <div class="tile">A</div>
                    <div class="tile">N</div>
                    <div class="tile">O</div>
                </div>
                <p class="small">La lettera <strong>I</strong> √® nella parola ma nel posto sbagliato.</p>
                <div class="example-row d-flex gap-2 mb-2">
                    <div class="tile">M</div>
                    <div class="tile">A</div>
                    <div class="tile">N</div>
                    <div class="tile" data-state="absent">G</div>
                    <div class="tile">O</div>
                </div>
                <p class="small">La lettera <strong>G</strong> non √® nella parola in nessun posto.</p>
            </div>
        </div>
    </div>

    <div id="stats-modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-secondary shadow-lg text-center">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="stats-modal">&times;</span>
            <h2 class="h4 text-gradient mb-4">STATISTICHE</h2>

            <!-- Word Result Message -->
            <div id="word-result-message" class="mb-3 p-3 rounded"
                style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); display: none;">
                <p id="word-result-text" class="mb-2"></p>
                <a id="word-result-link" href="#" target="_blank" rel="noopener noreferrer" class="text-decoration-none"
                    style="color: #10b981; font-weight: 600;">
                    Scopri di pi√π su 1parola.it ‚Üí
                </a>
            </div>

            <div id="statistics" class="d-flex justify-content-center gap-4 mb-4">
                <div class="statistic-container">
                    <div class="statistic h2 fw-bold mb-0" id="total-played">0</div>
                    <div class="label small opacity-75">Giocate</div>
                </div>
                <div class="statistic-container">
                    <div class="statistic h2 fw-bold mb-0" id="win-pct">0</div>
                    <div class="label small opacity-75">% Vittorie</div>
                </div>
                <div class="statistic-container">
                    <div class="statistic h2 fw-bold mb-0" id="current-streak">0</div>
                    <div class="label small opacity-75">Streak</div>
                </div>
                <div class="statistic-container">
                    <div class="statistic h2 fw-bold mb-0" id="max-streak">0</div>
                    <div class="label small opacity-75">Max Streak</div>
                </div>
            </div>


            <!-- Stats Tabs -->
            <ul class="nav nav-pills nav-fill mb-3" id="stats-tabs">
                <li class="nav-item">
                    <a class="nav-link active" id="overview-tab" data-tab="overview" href="#">Panoramica</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="graphs-tab" data-tab="graphs" href="#">Grafici</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="heatmap-tab" data-tab="heatmap" href="#">Heatmap</a>
                </li>
            </ul>

            <!-- Tab Content: Overview -->
            <div id="tab-overview" class="tab-content-stats">
                <h3 class="h5 mb-3">DISTRIBUZIONE TENTATIVI</h3>
                <div id="guess-distribution" class="mb-4">
                    <!-- Graph bars will be injected here -->
                </div>
            </div>

            <!-- Tab Content: Graphs -->
            <div id="tab-graphs" class="tab-content-stats hidden">
                <h3 class="h6 mb-3">Progressi nel Tempo</h3>
                <div class="chart-container mb-4" style="position: relative; height: 200px;">
                    <canvas id="progress-chart"></canvas>
                </div>
                <h3 class="h6 mb-3">Win Rate per Tentativo</h3>
                <div class="chart-container mb-3" style="position: relative; height: 180px;">
                    <canvas id="winrate-chart"></canvas>
                </div>
            </div>

            <!-- Tab Content: Heatmap -->
            <div id="tab-heatmap" class="tab-content-stats hidden">
                <h3 class="h6 mb-3">Attivit√† Giornaliera</h3>
                <div id="heatmap-container" class="mb-3">
                    <!-- Heatmap will be generated here -->
                </div>
                <div class="d-flex gap-2 align-items-center justify-content-center small opacity-75">
                    <span>Meno</span>
                    <div class="heatmap-legend">
                        <div class="heatmap-cell" data-level="0"></div>
                        <div class="heatmap-cell" data-level="1"></div>
                        <div class="heatmap-cell" data-level="2"></div>
                        <div class="heatmap-cell" data-level="3"></div>
                        <div class="heatmap-cell" data-level="4"></div>
                    </div>
                    <span>Pi√π</span>
                </div>
            </div>


            <div id="footer-actions" class="d-flex justify-content-center gap-2">
                <button id="play-again-btn" class="btn btn-glow px-4 py-2">GIOCA DI NUOVO</button>
                <button id="share-btn" class="btn btn-success px-4 py-2 d-flex align-items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        class="bi bi-share-fill" viewBox="0 0 16 16">
                        <path
                            d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.499 2.499 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5" />
                    </svg>
                    CONDIVIDI
                </button>
            </div>

            <!-- Reset Stats Button -->
            <div class="text-center mt-3 pt-3 border-top border-secondary">
                <button id="reset-stats-btn" class="btn btn-outline-danger btn-sm px-3">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" viewBox="0 0 24 24" width="16" class="me-1">
                        <path fill="currentColor"
                            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
                    </svg>
                    Azzera Tutte le Statistiche
                </button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div id="leaderboard-modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-secondary shadow-lg text-center">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="leaderboard-modal">&times;</span>
            <h2 class="h4 text-gradient mb-3">CLASSIFICA GLOBALE</h2>

            <!-- Leaderboard Filters -->
            <div class="leaderboard-filters mb-3 d-flex gap-2 justify-content-center flex-wrap">
                <button class="filter-btn active" data-period="daily">üìÖ Oggi</button>
                <button class="filter-btn" data-period="weekly">üìÜ Settimana</button>
                <button class="filter-btn" data-period="monthly">üìä Mese</button>
                <button class="filter-btn" data-period="alltime">üèÜ Sempre</button>
            </div>


            <div id="leaderboard-list" class="text-start" style="max-height: 300px; overflow-y: auto;">
                <div class="d-flex justify-content-center p-3">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <!-- Leaderboard items injected here -->
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-secondary shadow-lg text-center">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="profile-modal">&times;</span>
            <h2 class="h4 text-gradient mb-4">PROFILO UTENTE</h2>

            <div class="d-flex flex-column align-items-center mb-4">
                <img id="profile-modal-avatar" src="user.png" alt="Avatar"
                    class="rounded-circle border border-2 border-success mb-3 shadow"
                    style="width: 80px; height: 80px; object-fit: cover;">
                <p id="profile-modal-email" class="small opacity-75 mb-3">email@example.com</p>

                <!-- Edit Form -->
                <div class="w-100 text-start">
                    <div class="mb-3">
                        <label for="edit-display-name" class="form-label small text-uppercase fw-bold opacity-75">Nome
                            Visualizzato</label>
                        <input type="text" id="edit-display-name"
                            class="form-control bg-dark text-white border-secondary" placeholder="Il tuo nome">
                    </div>
                    <div class="mb-3">
                        <label for="edit-photo-url" class="form-label small text-uppercase fw-bold opacity-75">URL
                            Avatar</label>
                        <input type="text" id="edit-photo-url" class="form-control bg-dark text-white border-secondary"
                            placeholder="https://...">
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-center gap-3 mb-4">
                <div class="p-3 rounded border border-secondary bg-black bg-opacity-25 flex-grow-1">
                    <div class="h3 fw-bold text-success mb-0" id="profile-total-games">0</div>
                    <div class="small opacity-75">Partite</div>
                </div>
                <div class="p-3 rounded border border-secondary bg-black bg-opacity-25 flex-grow-1">
                    <div class="h3 fw-bold text-success mb-0" id="profile-total-wins">0</div>
                    <div class="small opacity-75">Vittorie</div>
                </div>
            </div>

            <div class="d-flex justify-content-between gap-2">
                <button id="logout-btn" class="btn btn-outline-danger px-4 rounded-pill">Logout</button>
                <button id="save-profile-btn" class="btn btn-primary px-4 rounded-pill">Salva Modifiche</button>
            </div>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievements-modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-secondary shadow-lg text-center">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="achievements-modal">&times;</span>
            <h2 class="h4 text-gradient mb-4">üèÜ ACHIEVEMENTS</h2>

            <div id="achievements-grid" class="achievements-grid">
                <!-- Achievements will be dynamically inserted here -->
            </div>

            <div class="mt-3 small opacity-75">
                <span id="unlocked-count">0</span> / <span id="total-count">0</span> sbloccati
            </div>
        </div>
    </div>

    <!-- Reset Stats Confirmation Modal -->
    <div id="reset-confirm-modal" class="game-modal hidden">
        <div class="glass-panel modal-content border border-danger shadow-lg text-center" style="max-width: 500px;">
            <span class="close-btn position-absolute top-0 end-0 p-3 fs-3" style="cursor: pointer;"
                data-target="reset-confirm-modal">&times;</span>

            <h2 class="h5 mb-3">‚ö†Ô∏è Conferma Cancellazione Statistiche</h2>

            <div class="alert alert-danger mb-3">
                <strong>ATTENZIONE!</strong> Questa azione √® <strong>irreversibile</strong>.
            </div>

            <div class="text-start mb-3">
                <p class="mb-2">Verranno eliminate <strong>TUTTE</strong> le seguenti informazioni:</p>
                <ul class="small">
                    <li>üìä Tutte le statistiche (partite giocate, vinte, streak)</li>
                    <li>üèÜ Tutti gli achievement sbloccati</li>
                    <li>üìà Cronologia delle partite e grafici</li>
                    <li>üóìÔ∏è Heatmap attivit√† giornaliera</li>
                    <li>‚òÅÔ∏è Dati sincronizzati sul cloud (se autenticato)</li>
                </ul>
            </div>

            <div class="alert alert-warning mb-3">
                <small>üí° <strong>Suggerimento:</strong> Se vuoi solo ricominciare da zero, considera di disconnetterti
                    e giocare in modalit√† ospite.</small>
            </div>

            <div class="form-check mb-3 text-start">
                <input class="form-check-input" type="checkbox" id="confirm-reset-checkbox">
                <label class="form-check-label small" for="confirm-reset-checkbox">
                    Ho letto e compreso che questa azione canceller√† definitivamente tutti i miei dati e non pu√≤ essere
                    annullata.
                </label>
            </div>

            <div class="d-flex gap-2 justify-content-center">
                <button id="cancel-reset-btn" class="btn btn-secondary px-4">Annulla</button>
                <button id="confirm-reset-btn" class="btn btn-danger px-4" disabled>
                    üóëÔ∏è Cancella Tutto
                </button>
            </div>
        </div>
    </div>

    <!-- Achievement Notification Toast -->
    <div id="achievement-notification" class="achievement-notification hidden">
        <div class="achievement-icon" id="achievement-notif-icon">üèÜ</div>
        <div class="achievement-details">
            <div class="achievement-title">Achievement Sbloccato!</div>
            <div class="achievement-name" id="achievement-notif-name"></div>
            <div class="achievement-desc small opacity-75" id="achievement-notif-desc"></div>
        </div>
    </div>

    <input type="text" id="native-keyboard-input" autocomplete="off" autocorrect="off" autocapitalize="off"
        spellcheck="false"
        style="position: absolute; opacity: 0; height: 0; width: 0; bottom: 0; left: 0; z-index: -1;">

    <div id="message-container"></div>
    </div>
    <script src="../../assets/js/components.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script type="module" src="main.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed', err));
            });
        }
    </script>
</body>

</html>